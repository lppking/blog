# 20190802

## js判断当前页面内的图片是否加载完成
现如今的某些网页追求绚丽的网页效果，可能会在网页中添加了大量的图片，动画或者一些视频资源等等。导致网页的体积变大，加载速度受到影响，如果不加控制，网速不是很理想的游客在初次登陆网站时可能会需要等待一个较长的加载时间。针对这种情况，现在比较常见的解决方案就是在页面增加一个可以显示当前网页加载进度的百分比loading效果。
给网页增加百分比进度条，我们就需要可以监听到资源的加载进度，这里针对图片进行一个简单的说明，
监听图片的加载进度比较简单，可以实用DOM提供的`onload`和`onerror`事件来捕获图片加载成功和失败的事件。
具体的思路可以参考以下代码：
```
var imgUrls = ["url1", "url2", "url3"];
var count = 0;
imgUrls.forEach(function (url) {
    var img = document.createElement('img');
    img.src = url;
    img.onload = function () {
        count++;
    };
    img.onerror = function () {
        //...
    }
])
```

## webp
webp是谷歌推出的一种在保证图片质量的情况下具有更高压缩比的一种图片文件格式。建议了解，[参考这里](https://www.hahack.com/wiki/sundries-webp.html)

## 绝对定位元素宽度如何被子元素撑开
主要针对的是父元素不定宽并且父元素绝对定位时如何被内容撑开不会换行。
```
position: absolute;
white-space: no-wrap;
```

## 移动端webview内嵌页面导致部分安卓机型出现屏幕闪烁问题
这里之所以说是部分安卓机型，是因为在测试过程中只有荣耀8出现这个问题，其他安卓机型还有没有问题不敢保证，因为我也没有测试所有机型。
最终问题的原因是因为页面内动画过多（包括css动画和一个3D动画）。最终移除3D动画后页面不再出现闪烁问题，所以我判断是手机性能问题导致的。这其中涉及到较多的CSS动画性能优化的东西，一些建议我有在上一篇周记中总结，这里不再赘述。
最后，我个人认为移动端（特别是部分老旧安卓）动画的使用需要谨慎，**哪怕是简单动画**。特别是非原生应用，在性能和适配上坑比较多。

## js new Date得到的时间从哪里来的
这个问题的来源是来自实际工作，页面中实现一个倒计时，这个倒计时持续时间固定，但是开始时间不固定，根据用户操作而定。刚开始是后端返回到期时间，前端通过`new Date()`获取当前时间。偶然间发现这种方式是有问题的，经过实际测试发现确实有问题，问题的核心就是：**new Date()获得的当前时间是相对于谁的当前时间？**
答案就是：**当前系统时间**。
我手动修改了系统时间之后，在浏览器中执行`new Date()`获得的时间并不是真正的当前时间，而是修改过的不准确的系统时间。所以new Date()须谨慎。
## MutationObserver
MutationObserver提供了异步监听目标DOM树变动的能力。核心能力两点：

 - 监听DOM树的变化
 - 异步

第一点很好理解，异步怎么理解呢？举个例子，像一个DOM容器中插入100个子元素，我们使用MutationObserver监听这个容器，当我们插入这100个子元素时，并不会触发MutationObserver callback 100次。而是在执行完所有的DOM操作后才会触发。
有关MutationObserver可以[参考这里](https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver)
   